<div class="funnel-scroll flex items-center gap-2 p-4 bg-gray-900 rounded-lg">
    {% for stage in stages %}
    <div class="flex-shrink-0 text-center px-4 py-2 rounded {{ stage.bg_color }}">
        <div class="text-lg font-bold">{{ stage.count }}</div>
        <div class="text-xs text-gray-400 flex items-center justify-center gap-0.5">
            <span>{{ stage.label }}</span>
            <span
                class="help-tip cursor-help text-gray-500 hover:text-gray-300 ml-0.5"
                data-tip="{{ stage.info }}"
                tabindex="0"
                aria-label="{{ stage.info }}"
            >â“˜</span>
        </div>
        <div class="text-[11px] text-gray-500 mt-0.5">
            {{ stage.processed }}/{{ stage.total }}
            {% match stage.pct %}
            {% when Some with (p) %}({{ "{:.1}"|format(p) }}%)
            {% when None %}(n/a)
            {% endmatch %}
        </div>
        {% if stage.unit_change_from_prev %}
        <div class="text-[10px] text-yellow-300/80 mt-0.5">unit change</div>
        {% endif %}
    </div>
    {% if !loop.last %}
    <div class="flex-shrink-0 text-center">
        <div class="text-gray-600">&rarr;</div>
        {% match stage.drop_pct %}
        {% when Some with (pct) %}
        <div class="text-xs {{ stage.drop_color }}">{{ pct }}</div>
        {% when None %}
        <div class="text-xs text-gray-700">-</div>
        {% endmatch %}
    </div>
    {% endif %}
    {% endfor %}
</div>
